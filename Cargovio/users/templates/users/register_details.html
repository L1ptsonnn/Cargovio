{% extends 'core/base.html' %}

{% block title %}Register Details - Cargovio{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Complete Registration</h2>
    <form id="registerDetailsForm" method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <div class="form-group">
            <label for="company_name">Company Name:</label>
            <input type="text" name="company_name" id="company_name" class="form-control" required>
        </div>
        <div class="form-group company-fields" style="display: none;">
            <label for="description">Description:</label>
            <textarea name="description" id="description" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group carrier-fields" style="display: none;">
            <label for="vehicle_type">Vehicle Type:</label>
            <select name="vehicle_type" id="vehicle_type" class="form-control">
                <option value="truck">Truck</option>
                <option value="van">Van</option>
                <option value="car">Car</option>
            </select>
        </div>
        <div class="form-group carrier-fields" style="display: none;">
            <label for="vehicle_capacity">Vehicle Capacity:</label>
            <input type="number" name="vehicle_capacity" id="vehicle_capacity" class="form-control">
        </div>
        <div class="form-group">
            <label for="phone_number">Phone Number:</label>
            <input type="tel" name="phone_number" id="phone_number" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="address">Address:</label>
            <textarea name="address" id="address" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Complete Registration</button>
    </form>
</div>

<script>
    // Show/hide fields based on user type
    const userType = '{{ user_type }}';
    if (userType === 'company') {
        document.querySelectorAll('.company-fields').forEach(el => el.style.display = 'block');
    } else if (userType === 'carrier') {
        document.querySelectorAll('.carrier-fields').forEach(el => el.style.display = 'block');
    }

    document.getElementById('registerDetailsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch('{% url "users:register_details" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = data.redirect;
            } else {
                alert(data.error);
            }
        });
    });
</script>
{% endblock %} 